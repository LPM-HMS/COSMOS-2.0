

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cosmos Initialization &mdash; Cosmos 2.13.11 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Workflows" href="workflows.html" />
    <link rel="prev" title="7. Local DRM GPUs" href="../examples/reattempt.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Cosmos
          

          
          </a>

          
            
            
              <div class="version">
                2.13.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cosmos Initialization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cosmos-api-cosmos">cosmos.api.Cosmos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell.html">Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cosmos</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Cosmos Initialization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/workflows/initializing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cosmos-initialization">
<span id="initializing"></span><h1>Cosmos Initialization<a class="headerlink" href="#cosmos-initialization" title="Permalink to this headline">¶</a></h1>
<p>Cosmos is initialized by instantiating a <code class="xref py py-class docutils literal notranslate"><span class="pre">cosmos.Cosmos</span></code> instance, which represents a connection to a SQL database.  The Cosmos instance can then
be used to start a Workflow.  If a Workflow already exists with the same name, it will be resumed and all failed Tasks will be deleted from the database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cosmos.api</span> <span class="kn">import</span> <span class="n">Cosmos</span>
<span class="n">cosmos</span> <span class="o">=</span> <span class="n">Cosmos</span><span class="p">(</span><span class="n">database_url</span><span class="o">=</span><span class="s1">&#39;sqlite:///my_cosmos_db.sqlite&#39;</span><span class="p">)</span>
<span class="n">cosmos</span><span class="o">.</span><span class="n">initdb</span><span class="p">()</span> <span class="c1"># creates the tables, if they already exist this does nothing</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">cosmos</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;My_Workflow&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You may have to install the python package required to use the driver you’d like. For example, if you are using
<code class="docutils literal notranslate"><span class="pre">postgres+psycopg2:///</span></code>, make sure you <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">psycopg2</span></code>.  See <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html">SQLAlchemy Engines</a>
for more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If is often very useful to maintain a one SQLite databsae per Workflow (especially for production environment), stored in the output directory of that Workflow.
This way, Workflows are completely atomic and all their provenance is nicely packed in a single location.</p>
</div>
<div class="section" id="cosmos-api-cosmos">
<h2>cosmos.api.Cosmos<a class="headerlink" href="#cosmos-api-cosmos" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="cosmos.api.Cosmos">
<em class="property">class </em><code class="sig-prename descclassname">cosmos.api.</code><code class="sig-name descname">Cosmos</code><span class="sig-paren">(</span><em class="sig-param">database_url: str = 'sqlite:///:memory:'</em>, <em class="sig-param">get_submit_args: callable = &lt;function default_get_submit_args&gt;</em>, <em class="sig-param">default_drm: str = 'local'</em>, <em class="sig-param">default_drm_options: Optional[Dict] = None</em>, <em class="sig-param">default_queue: Optional[str] = None</em>, <em class="sig-param">default_time_req: Optional[int] = None</em>, <em class="sig-param">default_max_attempts: int = 1</em>, <em class="sig-param">flask_app=None</em>, <em class="sig-param">default_job_class: Optional[str] = None</em>, <em class="sig-param">default_environment_variables: Optional[Dict] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="cosmos.api.Cosmos.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">database_url: str = 'sqlite:///:memory:'</em>, <em class="sig-param">get_submit_args: callable = &lt;function default_get_submit_args&gt;</em>, <em class="sig-param">default_drm: str = 'local'</em>, <em class="sig-param">default_drm_options: Optional[Dict] = None</em>, <em class="sig-param">default_queue: Optional[str] = None</em>, <em class="sig-param">default_time_req: Optional[int] = None</em>, <em class="sig-param">default_max_attempts: int = 1</em>, <em class="sig-param">flask_app=None</em>, <em class="sig-param">default_job_class: Optional[str] = None</em>, <em class="sig-param">default_environment_variables: Optional[Dict] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>database_url</strong> – A <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html">sqlalchemy database url</a>.  ex: sqlite:///home/user/sqlite.db or
mysql://user:pass&#64;localhost/database_name or postgresql+psycopg2://user:pass&#64;localhost/database_name</p></li>
<li><p><strong>get_submit_args</strong> – a function that returns arguments to be passed to the job submitter, like resource
requirements or the queue to submit to.  See <a class="reference internal" href="#cosmos.api.default_get_submit_args" title="cosmos.api.default_get_submit_args"><code class="xref py py-func docutils literal notranslate"><span class="pre">cosmos.api.default_get_submit_args()</span></code></a> for details</p></li>
<li><p><strong>flask_app</strong> (<em>flask.Flask</em>) – A Flask application instance for the web interface.  The default behavior is to create one.</p></li>
<li><p><strong>efault_drm</strong> – The Default DRM to use (ex ‘local’, ‘lsf’, or ‘ge’)</p></li>
<li><p><strong>default_drm_options</strong> – Default value for every Task.drm_options</p></li>
<li><p><strong>default_queue</strong> – Default value for every Task.queue</p></li>
<li><p><strong>default_time_req</strong> – Default value for every Task.time_req</p></li>
<li><p><strong>default_environment_variables</strong> – Default value for every Task.environment_variables</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="cosmos.api.Cosmos.start">
<code class="sig-name descname">start</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">restart</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">skip_confirm</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">primary_log_path</span><span class="o">=</span><span class="default_value">'workflow.log'</span></em>, <em class="sig-param"><span class="n">fail_fast</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start, resume, or restart an workflow based on its name.  If resuming, deletes failed tasks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – A name for the workflow.  Must be unique for this Cosmos session.</p></li>
<li><p><strong>restart</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – If True and the workflow exists, delete it first.</p></li>
<li><p><strong>skip_confirm</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – (If True, do not prompt the shell for input before deleting workflows or files.</p></li>
<li><p><strong>primary_log_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – The path of the primary log to write to.  If None, does not write to a file.  Log information is always printed to stderr.</p></li>
<li><p><strong>fail_fast</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – If True, terminate the workflow the first time a Task fails.</p></li>
<li><p><strong>default_max_attempts</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – The default maximum number of times to attempt a Task.</p></li>
</ul>
</dd>
</dl>
<p>Otherwise, run all Tasks except those downstream of a failure.
:rtype Workflow:
:returns: An Workflow instance.</p>
</dd></dl>

<dl class="py method">
<dt id="cosmos.api.Cosmos.initdb">
<code class="sig-name descname">initdb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.initdb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.initdb" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the database via sql CREATE statements.  If the tables already exists, nothing will happen.</p>
</dd></dl>

<dl class="py method">
<dt id="cosmos.api.Cosmos.resetdb">
<code class="sig-name descname">resetdb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.resetdb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.resetdb" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets (deletes then initializes) the database.  This is not reversible!</p>
</dd></dl>

<dl class="py method">
<dt id="cosmos.api.Cosmos.runweb">
<code class="sig-name descname">runweb</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">host</span></em>, <em class="sig-param"><span class="n">port</span></em>, <em class="sig-param"><span class="n">debug</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.runweb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.runweb" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the web dashboard
:param str host: Host name to bind to.  Default is local host, but commonly 0.0.0.0 to allow outside internet traffic.
:param int port: Port to bind to.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="cosmos.api.default_get_submit_args">
<code class="sig-prename descclassname">cosmos.api.</code><code class="sig-name descname">default_get_submit_args</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">task</span></em>, <em class="sig-param"><span class="n">parallel_env</span><span class="o">=</span><span class="default_value">'orte'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#default_get_submit_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.default_get_submit_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Default method for determining the extra arguments to pass to the DRM.
For example, returning <cite>“-n 3” if</cite> <cite>task.drm == “lsf”</cite> would cause all jobs
to be submitted with <cite>bsub -n 3</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>task</strong> (<em>cosmos.api.Task</em>) – The Task being submitted.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)">str</a></p>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="workflows.html" class="btn btn-neutral float-right" title="Workflows" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../examples/reattempt.html" class="btn btn-neutral float-left" title="7. Local DRM GPUs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2013 Erik Gafni

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>